!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-post-process",["babylonjs"],t):"object"==typeof exports?exports["babylonjs-post-process"]=t(require("babylonjs")):e.POSTPROCESSES=t(e.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(e=>(()=>{"use strict";var t={597:t=>{t.exports=e}},r={};function o(e){var i=r[e];if(void 0!==i)return i.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};o.d(i,{default:()=>T});var n={};o.r(n),o.d(n,{AsciiArtFontTexture:()=>g,AsciiArtPostProcess:()=>u,DigitalRainFontTexture:()=>m,DigitalRainPostProcess:()=>p,EdgeDetectionPostProcess:()=>S});var a={};o.r(a),o.d(a,{AsciiArtFontTexture:()=>g,AsciiArtPostProcess:()=>u,DigitalRainFontTexture:()=>m,DigitalRainPostProcess:()=>p,EdgeDetectionPostProcess:()=>S});var l=function(e,t){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},l(e,t)};function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function s(e,t,r,o){var i,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(n<3?i(a):n>3?i(t,r,a):i(t,r))||a);return n>3&&a&&Object.defineProperty(t,r,a),a}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var c=o(597),d="asciiartPixelShader";c.ShaderStore.ShadersStore[d]||(c.ShaderStore.ShadersStore[d]="varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D asciiArtFont;uniform vec4 asciiArtFontInfos;uniform vec4 asciiArtOptions;float getLuminance(vec3 color)\n{return clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{float caracterSize=asciiArtFontInfos.x;float numChar=asciiArtFontInfos.y-1.0;float fontx=asciiArtFontInfos.z;float fonty=asciiArtFontInfos.w;float screenx=asciiArtOptions.x;float screeny=asciiArtOptions.y;float tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;float tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;vec2 tileUV=vec2(tileX,tileY);vec4 tileColor=texture2D(textureSampler,tileUV);vec4 baseColor=texture2D(textureSampler,vUV);float tileLuminance=getLuminance(tileColor.rgb);float offsetx=(float(floor(tileLuminance*numChar)))*caracterSize/fontx;float offsety=0.0;float x=float(mod(gl_FragCoord.x,caracterSize))/fontx;float y=float(mod(gl_FragCoord.y,caracterSize))/fonty;vec4 finalColor= texture2D(asciiArtFont,vec2(offsetx+x,offsety+(caracterSize/fonty-y)));finalColor.rgb*=tileColor.rgb;finalColor.a=1.0;finalColor= mix(finalColor,tileColor,asciiArtOptions.w);finalColor= mix(finalColor,baseColor,asciiArtOptions.z);gl_FragColor=finalColor;}");var g=function(e){function t(t,r,o,i){void 0===i&&(i=null);var n=e.call(this,i)||this;if(!(i=n.getScene()))return n;n.name=t,n._text,n._font,n.wrapU=c.Texture.CLAMP_ADDRESSMODE,n.wrapV=c.Texture.CLAMP_ADDRESSMODE;var a=n._getFontHeight(r),l=n._getFontWidth(r);n._charSize=Math.max(a.height,l);var f=Math.ceil(n._charSize*o.length),s=n._charSize;n._texture=i.getEngine().createDynamicTexture(f,s,!1,c.Texture.NEAREST_SAMPLINGMODE);var d=n.getSize(),g=document.createElement("canvas");g.width=d.width,g.height=d.height;var u=g.getContext("2d");u.textBaseline="top",u.font=r,u.fillStyle="white",u.imageSmoothingEnabled=!1;for(var h=0;h<o.length;h++)u.fillText(o[h],h*n._charSize,-a.offset);return i.getEngine().updateDynamicTexture(n._texture,g,!1,!0),n}return f(t,e),Object.defineProperty(t.prototype,"charSize",{get:function(){return this._charSize},enumerable:!1,configurable:!0}),t.prototype._getFontWidth=function(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="white",t.font=e,t.measureText("W").width},t.prototype._getFontHeight=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");r.fillRect(0,0,t.width,t.height),r.textBaseline="top",r.fillStyle="white",r.font=e,r.fillText("jH|",0,0);for(var o=r.getImageData(0,0,t.width,t.height).data,i=-1,n=-1,a=0;a<t.height;a++)for(var l=0;l<t.width;l++){if(0!==o[4*(a*t.width+l)]){-1===i&&(i=a);break}if(l===t.width-1&&-1!==i){n=a,a=t.height;break}}return{height:n-i+1,offset:i-1}},t.prototype.clone=function(){return new t(this.name,this._font,this._text,this.getScene())},t.Parse=function(e,r){return c.SerializationHelper.Parse((function(){return new t(e.name,e.font,e.text,r)}),e,r,null)},s([(0,c.serialize)("font")],t.prototype,"_font",void 0),s([(0,c.serialize)("text")],t.prototype,"_text",void 0),t}(c.BaseTexture),u=function(e){function t(t,r,o){var i=e.call(this,t,"asciiart",["asciiArtFontInfos","asciiArtOptions"],["asciiArtFont"],1,r,c.Texture.TRILINEAR_SAMPLINGMODE,void 0,!0)||this;i.mixToTile=0,i.mixToNormal=0;var n="40px Monospace",a=" `-.'_:,\"=^;<+!*?/cL\\zrs7TivJtC{3F)Il(xZfY5S2eajo14[nuyE]P6V9kXpKwGhqAUbOd8#HRDB0$mgMW&Q%N@";o&&("string"==typeof o?n=o:(n=o.font||n,a=o.characterSet||a,i.mixToTile=o.mixToTile||i.mixToTile,i.mixToNormal=o.mixToNormal||i.mixToNormal));var l=(null==r?void 0:r.getScene())||i._scene;i._asciiArtFontTexture=new g(t,n,a,l);var f=i._asciiArtFontTexture.getSize();return i.onApply=function(e){e.setTexture("asciiArtFont",i._asciiArtFontTexture),e.setFloat4("asciiArtFontInfos",i._asciiArtFontTexture.charSize,a.length,f.width,f.height),e.setFloat4("asciiArtOptions",i.width,i.height,i.mixToNormal,i.mixToTile)},i}return f(t,e),t}(c.PostProcess),h="digitalrainPixelShader";c.ShaderStore.ShadersStore[h]||(c.ShaderStore.ShadersStore[h]="varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D digitalRainFont;uniform vec4 digitalRainFontInfos;uniform vec4 digitalRainOptions;uniform mat4 matrixSpeed;uniform float cosTimeZeroOne;float getLuminance(vec3 color)\n{return clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{float caracterSize=digitalRainFontInfos.x;float numChar=digitalRainFontInfos.y-1.0;float fontx=digitalRainFontInfos.z;float fonty=digitalRainFontInfos.w;float screenx=digitalRainOptions.x;float screeny=digitalRainOptions.y;float ratio=screeny/fonty;float columnx=float(floor((gl_FragCoord.x)/caracterSize));float tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;float tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;vec2 tileUV=vec2(tileX,tileY);vec4 tileColor=texture2D(textureSampler,tileUV);vec4 baseColor=texture2D(textureSampler,vUV);float tileLuminance=getLuminance(tileColor.rgb);int st=int(mod(columnx,4.0));float speed=cosTimeZeroOne*(sin(tileX*314.5)*0.5+0.6); \nfloat x=float(mod(gl_FragCoord.x,caracterSize))/fontx;float y=float(mod(speed+gl_FragCoord.y/screeny,1.0));y*=ratio;vec4 finalColor= texture2D(digitalRainFont,vec2(x,1.0-y));vec3 high=finalColor.rgb*(vec3(1.2,1.2,1.2)*pow(1.0-y,30.0));finalColor.rgb*=vec3(pow(tileLuminance,5.0),pow(tileLuminance,1.5),pow(tileLuminance,3.0));finalColor.rgb+=high;finalColor.rgb=clamp(finalColor.rgb,0.,1.);finalColor.a=1.0;finalColor= mix(finalColor,tileColor,digitalRainOptions.w);finalColor= mix(finalColor,baseColor,digitalRainOptions.z);gl_FragColor=finalColor;}");var m=function(e){function t(t,r,o,i){void 0===i&&(i=null);var n=e.call(this,i)||this;if(!(i=n.getScene()))return n;n.name=t,n._text,n._font,n.wrapU=c.Texture.CLAMP_ADDRESSMODE,n.wrapV=c.Texture.CLAMP_ADDRESSMODE;var a=n._getFontHeight(r),l=n._getFontWidth(r);n._charSize=Math.max(a.height,l);var f=n._charSize,s=Math.ceil(n._charSize*o.length);n._texture=i.getEngine().createDynamicTexture(f,s,!1,c.Texture.NEAREST_SAMPLINGMODE);var d=n.getSize(),g=document.createElement("canvas");g.width=d.width,g.height=d.height;var u=g.getContext("2d");u.textBaseline="top",u.font=r,u.fillStyle="white",u.imageSmoothingEnabled=!1;for(var h=0;h<o.length;h++)u.fillText(o[h],0,h*n._charSize-a.offset);return i.getEngine().updateDynamicTexture(n._texture,g,!1,!0),n}return f(t,e),Object.defineProperty(t.prototype,"charSize",{get:function(){return this._charSize},enumerable:!1,configurable:!0}),t.prototype._getFontWidth=function(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="white",t.font=e,t.measureText("W").width},t.prototype._getFontHeight=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");r.fillRect(0,0,t.width,t.height),r.textBaseline="top",r.fillStyle="white",r.font=e,r.fillText("jH|",0,0);for(var o=r.getImageData(0,0,t.width,t.height).data,i=-1,n=-1,a=0;a<t.height;a++)for(var l=0;l<t.width;l++){if(0!==o[4*(a*t.width+l)]){-1===i&&(i=a);break}if(l===t.width-1&&-1!==i){n=a,a=t.height;break}}return{height:n-i+1,offset:i-1}},t.prototype.clone=function(){return new t(this.name,this._font,this._text,this.getScene())},t.Parse=function(e,r){return c.SerializationHelper.Parse((function(){return new t(e.name,e.font,e.text,r)}),e,r,null)},s([(0,c.serialize)("font")],t.prototype,"_font",void 0),s([(0,c.serialize)("text")],t.prototype,"_text",void 0),t}(c.BaseTexture),p=function(e){function t(t,r,o){var i=e.call(this,t,"digitalrain",["digitalRainFontInfos","digitalRainOptions","cosTimeZeroOne","matrixSpeed"],["digitalRainFont"],1,r,c.Texture.TRILINEAR_SAMPLINGMODE,void 0,!0)||this;i.mixToTile=0,i.mixToNormal=0,i.speed=.003;var n="15px Monospace";o&&("string"==typeof o?n=o:(n=o.font||n,i.mixToTile=o.mixToTile||i.mixToTile,i.mixToNormal=o.mixToNormal||i.mixToNormal));var a=(null==r?void 0:r.getScene())||null;i._digitalRainFontTexture=new m(t,n,"古池や蛙飛び込む水の音ふるいけやかわずとびこむみずのおと初しぐれ猿も小蓑をほしげ也はつしぐれさるもこみのをほしげなり江戸の雨何石呑んだ時鳥えどのあめなんごくのんだほととぎす",a);var l=i._digitalRainFontTexture.getSize(),f=0,s=0,d=c.Matrix.FromValues(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random());return i.onApply=function(e){e.setTexture("digitalRainFont",i._digitalRainFontTexture),e.setFloat4("digitalRainFontInfos",i._digitalRainFontTexture.charSize,86,l.width,l.height),e.setFloat4("digitalRainOptions",i.width,i.height,i.mixToNormal,i.mixToTile),e.setMatrix("matrixSpeed",d),f+=i.speed,s=f,e.setFloat("cosTimeZeroOne",s)},i}return f(t,e),t}(c.PostProcess),x="edgeDetectionPixelShader";c.ShaderStore.ShadersStore[x]||(c.ShaderStore.ShadersStore[x]="precision highp float;varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D normalSampler;uniform sampler2D depthSampler;uniform float width;uniform float height;uniform vec3 edgeColor;uniform float edgeIntensity;uniform float edgeWidth;uniform int renderMode; \nvec3 boxBlur(sampler2D sampler,vec2 uv,vec2 texelSize) {vec3 result=vec3(0.0);for (int x=-1; x<=1; x++) {for (int y=-1; y<=1; y++) {vec2 offset=vec2(float(x),float(y))*texelSize;result+=texture2D(sampler,uv+offset).rgb;}}\nreturn result/9.0;}\nvoid main(void) {vec2 texelSize=vec2(1.0/width,1.0/height);vec3 originalColor=texture2D(textureSampler,vUV).rgb;if (renderMode==1 || renderMode==2 || renderMode==3) {if (length(originalColor)==0.0) {originalColor=vec3(1.0,1.0,1.0); }\nif (originalColor.r==1.0 && originalColor.g==0.0 && originalColor.b==0.0) {originalColor=vec3(1.0,1.0,1.0); }}\nvec3 normal=texture2D(normalSampler,vUV).rgb;float depth=texture2D(depthSampler,vUV).r;float edgeStrength=0.0;int range=int(edgeWidth*8.0); \nfor (int x=-range; x<=range; x++) {for (int y=-range; y<=range; y++) {if (x==0 && y==0) {continue;}\nvec3 neighborNormal=texture2D(normalSampler,vUV+texelSize*vec2(float(x),float(y))).rgb;float neighborDepth=texture2D(depthSampler,vUV+texelSize*vec2(float(x),float(y))).r;float normalDiff=length(neighborNormal-normal);float depthDiff=abs(neighborDepth-depth);edgeStrength=max(edgeStrength,max(normalDiff,depthDiff));}}\nedgeStrength=smoothstep(edgeWidth,edgeWidth+edgeIntensity,edgeStrength);vec3 finalColor=mix(originalColor,edgeColor,edgeStrength);gl_FragColor=vec4(finalColor,1.0);}");var S=function(e){function t(t,r,o,i,n,a,l){void 0===l&&(l=c.Constants.TEXTURETYPE_UNSIGNED_BYTE);var f=e.call(this,t,"edgeDetection",["width","height","edgeColor","edgeIntensity","edgeWidth","renderMode"],["normalSampler","depthSampler"],o,i,n,r.getEngine(),a,null,l)||this;if(f.edgeColor=new c.Color3(0,0,0),f.edgeIntensity=.2,f.edgeWidth=.2,f.renderMode=0,f._geometryBufferRenderer=r.enableGeometryBufferRenderer(),f._geometryBufferRenderer){var s=new c.RenderTargetTexture("h1",{width:f.width,height:f.height},r,{samplingMode:c.Constants.TEXTURE_NEAREST_NEAREST,generateMipMaps:!1,generateDepthBuffer:!1,type:c.Constants.TEXTURETYPE_HALF_FLOAT});f.onApply=function(e){e.setFloat("width",f.width),e.setFloat("height",f.height),e.setFloat("edgeIntensity",f.edgeIntensity),e.setFloat("edgeWidth",f.edgeWidth),e.setColor3("edgeColor",f.edgeColor);var t=f._geometryBufferRenderer.getGBuffer().textures[1],r=f._geometryBufferRenderer.getGBuffer().textures[0];switch(e.setTexture("normalSampler",t),e.setTexture("depthSampler",r),f.renderMode){case 0:break;case 1:e.setTexture("textureSampler",f._geometryBufferRenderer.getGBuffer().textures[1]),e.setFloat("edgeWidth",0);break;case 2:e.setTexture("textureSampler",f._geometryBufferRenderer.getGBuffer().textures[0]),e.setFloat("edgeWidth",0);break;case 3:e.setTexture("textureSampler",s)}e.setInt("renderMode",f.renderMode)}}else c.Logger.Error("Geometry Buffer Renderer support is required for this post-process.");return f}return f(t,e),t.prototype.getClassName=function(){return"EdgeDetectionPostProcess"},Object.defineProperty(t,"IsSupported",{get:function(){var e=c.EngineStore.LastCreatedEngine;return!!e&&e.getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),t._Parse=function(e,r,o,i){return c.SerializationHelper.Parse((function(){return new t(e.name,o,e.options,r,e.renderTargetSamplingMode,e.textureType,e.reusable)}),e,o,i)},s([(0,c.serialize)()],t.prototype,"edgeColor",void 0),s([(0,c.serialize)()],t.prototype,"edgeIntensity",void 0),s([(0,c.serialize)()],t.prototype,"edgeWidth",void 0),s([(0,c.serialize)()],t.prototype,"renderMode",void 0),t}(c.PostProcess);(0,c.RegisterClass)("BABYLON.EdgeDetectionPostProcess",S);var v=void 0!==o.g?o.g:"undefined"!=typeof window?window:void 0;if(void 0!==v)for(var y in n)v.BABYLON[y]=n[y];const T=a;return i.default})()));
//# sourceMappingURL=babylonjs.postProcess.min.js.map